# For more information: https://laravel.com/docs/sail
version: '3'
services:
  laravel:
    image: twellness/laravel:latest
    container_name: twellness_laravel
    volumes:
      - .:/var/www/laravel
    networks:
      - twellness-network
    depends_on:
      - mysql

  mysql:
    image: mysql:8.0.29
    command:
      [
        "mysqld",
        "--default-authentication-plugin=mysql_native_password"
      ]
    container_name: twellness_mysql
    tty: true
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: '${DB_PASSWORD}'
      MYSQL_ROOT_HOST: "%"
      MYSQL_DATABASE: '${DB_DATABASE}'
      MYSQL_USER: '${DB_USERNAME}'
      MYSQL_PASSWORD: '${DB_PASSWORD}'
      MYSQL_ALLOW_EMPTY_PASSWORD: 1
    volumes:
      - dbdata:/var/lib/mysql/
    networks:
      - twellness-network

  nginx:
    image: twellness/nginx:latest
    container_name: twellness_nginx
    ports:
      - 80:80
      - 443:443
    networks:
      - twellness-network
    volumes:
      - .:/var/www/laravel
      - ./nginx/site.conf:/etc/nginx/conf.d/default.conf
    extra_hosts:
      - host.docker.internal:host-gateway

  redis:
    image: redis:latest
    container_name: twellness_redis
    volumes:
      - redisdata:/data
    ports:
      - "6379:6379"
    networks:
      - twellness-network

networks:
  twellness-network:
    driver: bridge
volumes:
  dbdata: { }
  redisdata: { }
